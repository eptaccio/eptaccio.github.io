{"componentChunkName":"component---src-templates-blog-post-js","path":"/telegram-bot/","result":{"data":{"site":{"siteMetadata":{"title":"eptaccio"}},"markdownRemark":{"id":"548ebd29-b896-56e6-a62d-291025bb85a4","excerpt":"Eu gosto muito de criar bots, principalmente no telegram pela facilidade. Na verdade eu sempre fui um grande evangelista do Telegram, quem me conhece sabe disso…","html":"<p>Eu gosto muito de criar bots, principalmente no telegram pela facilidade. Na verdade eu sempre fui um grande evangelista do Telegram, quem me conhece sabe disso. Então nada mais justo do que falar sobre bots nessa plataforma que simplifica muito o processo de criação dos mesmos.</p>\n<p>Tá, basicamente vou mostrar duas coisas:</p>\n<ol>\n<li>Como criar um chatbot (usando node.js)</li>\n<li>Como deixar ele “rodando” de graça usando o now.sh</li>\n</ol>\n<h2>Criando o bot no telegram</h2>\n<p>É bem fácil criar um bot no telegram, é tão facil que o telegram tem um bot que cria bots, no caso o <a href=\"http://t.me/BotFather\">@BotFather</a>. É bem simples, inicie a conversa com o BotFather, execute o comando <strong>/newbot</strong> e siga as instruções. No final ele vai te gerar um token para você continuar com o processo.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 416px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0bb9b70bb305fdd80aead4316a4e5231/b0122/token.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADBklEQVQ4y01UyU4bQRD1x0RIEAzY421sjz2LZ5/pGdvjBVBuUSSwDd4AQ3KIlENOkRJAiHxbwBxDvuKluu1YOTzVNvWqurp6UoPxDPObT5heXWO6uMFs8RGza8LVDaYXC8K1wOzyRsjJfOWbk73yLXA2ucB4donX1z9ISZKChupBVRxYWgCj7sEi1Oo2qoaLuulBIak7IVQrELpKuuFHwq43XGSKCrb3cnh6ekZKyWiIqgx+yUNcZmDVEC2ZwdFCeM0O3LANlyUI4g6CZhdulIDZLcRBFw5rw2/2ELZ6kGsGnpdLpOpOANY7hp/0BMLuITySLOmLZJ+IvKgDh4g5YUDJfjVAqEbw2z2KJdDtEFKphuXyBamKaiFKDkUXPgV5R5zAX3fkx12RZHN/nAjisNMXxXmc5zphC4WKuu7Q9MVHnIC1+4jX5AEdJe4eiy75cXliSHFB0ia91RdH5QVNL0ZOXnfIh8yTFd2GJKsoVnWqpqFAMk/yH7i/qBgo1RobySHXGyKeLSkrwl1JhqxZyFU15KhtqbwC11c+IleInAilch38+51MEW//R7ZEM1wTyhUDLKQ5uU0EQQLTpBt2mnDIdgm2E8Min+c1UaFvLTdGky6Rj4Aj7hyJE25mWC0YCLUIbi2Ap4ZwCdz29Ujors7QNhN4RoSA/F8+f8XtwyNu7x/x4/4Bdw8/8e37HRTNxi++h5rD0Dp8B5evB+0d45U7VLl7JC6h4cewWYsWmwnZoAvg86wQgVw3UVZt1Gi5Nx1maX802ni+PmWCojv0GhxhVykpS68gTXPby5WxJ5WFPCBfRqAGns/1zR4W6MZUO6DKEXUTQXcZNP60vJVuBrHQTerU8pvidRgUz9HFFdYbwfU8YflChPk3RRgZA1pGF7D3GzDSGpQDFda+AX1Pg0Yo0Jvfpe54J/v5MrZ2JWylJWzv55HOVbBzUKAZPiH14f0Ak9Eco8FE4HwwxXgww2hI8nS2sYfDCU5GY5wMz3FKcng+xeBsihH9rcazK/rjzPH79RV/AUXcUaH8r1dPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Criação do token\"\n        title=\"Criação do token\"\n        src=\"/static/0bb9b70bb305fdd80aead4316a4e5231/b0122/token.png\"\n        srcset=\"/static/0bb9b70bb305fdd80aead4316a4e5231/12f09/token.png 148w,\n/static/0bb9b70bb305fdd80aead4316a4e5231/e4a3f/token.png 295w,\n/static/0bb9b70bb305fdd80aead4316a4e5231/b0122/token.png 416w\"\n        sizes=\"(max-width: 416px) 100vw, 416px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Vamos de código</h2>\n<p>Usando node.js vou mostrar uma lib para telegram deveras charmosa chamada Telegraf. A API oficial do telegram possui várias rotas e permite várias coisas, essa lib basicamente encapsula esses métodos para facilitar nossa vida.</p>\n<p>A plataforma do telegram tem suporte a webhooks. É aí que entra nosso futuro deploy usando now.sh. O now é uma plataforma de zeit bem da hora que permite deploy de funções serverless.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa86cc8aea743cae903d4afb6ecf3c85/77800/telegram-webhook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABhUlEQVQY0zVQbSuDURg+XpOQsfZBKUtobL4pyl9QfoekmbGZ9hZtzcuWD8InP4Hy8sUniU9olCjM9jzPeZ6Z9qJkC3O5n2NOXd2dc93Xde7rZrx3BaotSoiBd0eQHttBGUDpVoPSvwp1IApuJX4wBqUzhHz0BPr5KnxAG9kA7yO9zhN0L8aZHZw5CbNQ2BRUc0QIvuMaJDYj3rmoc3SfRM55IPhyoQil0Uua/x5d7wBLtfggGYOQ2gNINnjwMriOs9tL8ONrqNUeyM0+pEzEtwUgkyAzu4/z+ysUlAw04xISPWEkRtfxNByDZPCDJTsWkTKHBJ6NfuSHNmH3u3C6tYtsfQCpZi+SlmVIXSExQdqxhwmvA0/xO7yawni0RvAwvo2EbQVyrUePrI/sqmAaat/qX6SbNEWcoze3iKtSlWk9Wdeh4H/eSlBaaeo6StHkq/Q5wRRqVigar/HQBE5oljX8kKB4IZOB/sk88fPgtQv0gR0595Ew/My+gxuClf2RWRX1kdcvRLZHHQieej0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fluxo telegram\"\n        title=\"Fluxo telegram\"\n        src=\"/static/fa86cc8aea743cae903d4afb6ecf3c85/fcda8/telegram-webhook.png\"\n        srcset=\"/static/fa86cc8aea743cae903d4afb6ecf3c85/12f09/telegram-webhook.png 148w,\n/static/fa86cc8aea743cae903d4afb6ecf3c85/e4a3f/telegram-webhook.png 295w,\n/static/fa86cc8aea743cae903d4afb6ecf3c85/fcda8/telegram-webhook.png 590w,\n/static/fa86cc8aea743cae903d4afb6ecf3c85/77800/telegram-webhook.png 855w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Basicamente vamos precisar de uma API, para que o telegram chame a mesma quando algum usuário interagir com nosso BOT.</p>\n<h2>Configurando nossa API para Webhook</h2>\n<p>O primeiro passo é criar uma API simples. Nesse exemplo vou usar express pela popularidade.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> Telegraf <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'telegraf'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">APP_PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3000</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">BOT_TOKEN</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CURRENT_HOST</span> <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token comment\">// instanciando o bot</span>\n<span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Telegraf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BOT_TOKEN</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  telegram<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    webhookReply<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// configuração de ação tosca no bot</span>\nbot<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">reply</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">msg recebida de: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ctx<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>from<span class=\"token punctuation\">.</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// união entre bot e express</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">.</span><span class=\"token function\">webhookCallback</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/callback'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/setup'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">CURRENT_HOST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/callback</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">await</span> bot<span class=\"token punctuation\">.</span>telegram<span class=\"token punctuation\">.</span><span class=\"token function\">setWebhook</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">listening on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">CURRENT_HOST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">APP_PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">listening on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">APP_PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>O esquema é criar uma API simples, com uma rota de /setup inicialmente, que vai ser útil mais tarde. Claro, não esqueça de instalar os módulos (express e telegraf).</p>\n<h3>Explicando esta merda por partes:</h3>\n<p>1 — Instanciando nosso bot com o TOKEN que você gerou utilizando o BotFather lá no primeiro passo.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// instanciando o bot</span>\n<span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Telegraf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BOT_TOKEN</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  telegram<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    webhookReply<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>2 — Configuração do o Webhook no telegram.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/setup'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">CURRENT_HOST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/callback</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">await</span> bot<span class=\"token punctuation\">.</span>telegram<span class=\"token punctuation\">.</span><span class=\"token function\">setWebhook</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">listening on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">CURRENT_HOST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>— Mas Marcos porque você uma rota para isso em vez de fazer na inicialização do código?</em></p>\n<p>Fiz assim para evitar uns pipocos depois de subir no now.sh, foi a melhora forma que encontrei por enquanto.</p>\n<p>Nessa variável <strong>CURRENT_HOST</strong> vamos adicionar posteriormente a URL que o now vai nos fornecer para acesso da nossa API.</p>\n<p>3 — Definição de ação do BOT</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// configuração de ação tosca no bot</span>\nbot<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">reply</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">msg recebida de: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ctx<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>from<span class=\"token punctuation\">.</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Uma coisa legal do telegraf é que podemos definir ações com base em eventos, nesse caso um evento de texto digitado pelo usuário. Nesse caso vamos apenas responder que a mensagem foi respondida.</p>\n<p>4 — União entre telefraf e express</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">.</span><span class=\"token function\">webhookCallback</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/callback'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Configuração para a instancia do BOT passar a funcionar e acionar os eventos disponíveis a partir de webhook.</p>\n<h2>Configurando o deploy</h2>\n<p>Man, cria um conta no <a href=\"now.sh\">now.sh</a> depois instala o CLI deles com o npm (npm i -g now).</p>\n<p>No código crie um arquivo chamado now.json na raiz do projeto. Nesse arquivo vamos fazer as configurações necessárias para o deploy da nossa função. Eu estou chamando isso de função pois, apesar de ser uma API no final das contas isso vai virar uma função serveless na estrutura do now, que por fins de curiosidade utiliza o AWS Lambda para funcionar, não me pergunte como esse pessoal ganha dinheiro.</p>\n<p><em>—Pera pera pera, vamos hospedar o bot nesse role de serveless ai e pa, mas quanto vai custar?</em></p>\n<p>Nada, o now tem uns limites bem generosos de funções rodando, desde que seja open source. A partir do momento que você faz um deploy <strong>no modo FREE seu código fica automaticamente exposto na interwebs</strong>, portanto fique <strong>LIGEIRO</strong> com coisas que não devem ser públicas, como o token do bot por exemplo. Utilize variáveis de ambiente. Na verdade, sempre utilize variáveis de ambiente para informações muito sensíveis, me ajude a te ajudar</p>\n<p>A configuração que você precisa montar para o now rodar seu bot é basicamente essa:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"alias\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"nome-do-seu-bot-bosta.now.sh\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"public\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"builds\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"use\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@now/node-server\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"routes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"headers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Access-Control-Allow-Origin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Access-Control-Allow-Methods\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET, POST, PUT, DELETE, OPTIONS\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Access-Control-Allow-Headers\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"X-Requested-With, Content-Type, Accept\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/.*\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"dest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/index.js\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Você pode copiar essa config e substituir a parte do nome-do-seu-bot-bosta para o nome real do seu BOT já que ele já vai funcionar, deixei alguns outros comentários para explicar o que está rolando na config.</p>\n<p>Lembra a variável CURRENT_HOST? Coloque nela o mesmo conteúdo que colocou no seu ALIAS da configuração do now.sh, mas adicionei um https nesse caso. Ex:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">CURRENT_HOST</span> <span class=\"token operator\">=</span> “https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>nome<span class=\"token operator\">-</span><span class=\"token keyword\">do</span><span class=\"token operator\">-</span>seu<span class=\"token operator\">-</span>bot<span class=\"token operator\">-</span>bosta<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">.</span>sh”</code></pre></div>\n<h3>Lançando o deploy</h3>\n<p>Abre o terminal ou CMD que tu tem ai e roda:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">now -e <span class=\"token assign-left variable\">BOT_TOKEN</span><span class=\"token operator\">=</span>token-do-seu-bot  - -prod</code></pre></div>\n<p>Bem simples né? Como é sua primeira vez (ou não) rodando isso, talvez ele te peça para fazer login e após isso ele vai mostrar informações sobre seu deploy.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/272f9ee765f1ce7558a0b9a1f8375c6c/b4098/now.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABF0lEQVQY01WO626DMAyF+yiFFkgISYBwKwGSkACBXqT+mKa9/4vM235Nsqwj+3z2OXHZITmhSfFeIkLPCQ4xCVB6wSTEGehfQSKSoYxdYZ7gvwJ96keljdXGzG7plS4n3cy2UiatWz6MpL0FlJ0pjzNG8zKCW/9gOSi3aruYZVWzHbVZtn1e1mFS7U2KpsUZvYI7RmGCAAhjFERJEKMLwB1YlJlmazfvvNduPZ4v/3iu+2FXP2ijZjdANOfA0PQDpryoGlZWUUpOH1+fclIQ3m77th+LP7b7AzB/fzq/u20H+DaMUmnwFFWdUk54nhD6E/v93ljZdHKEY6LpoLNC0ELkogYBxUVFizLjBStFXtXwFlYwTFn+DWAZS7383FYgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"deploy usando now\"\n        title=\"deploy usando now\"\n        src=\"/static/272f9ee765f1ce7558a0b9a1f8375c6c/fcda8/now.png\"\n        srcset=\"/static/272f9ee765f1ce7558a0b9a1f8375c6c/12f09/now.png 148w,\n/static/272f9ee765f1ce7558a0b9a1f8375c6c/e4a3f/now.png 295w,\n/static/272f9ee765f1ce7558a0b9a1f8375c6c/fcda8/now.png 590w,\n/static/272f9ee765f1ce7558a0b9a1f8375c6c/b4098/now.png 816w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Feito isso precisamos fazer a configuração do webhook no telegram chamando a rota <strong>/setup</strong> da nossa API. Então é so acessar a sua URL configurada na rota de setup.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 539px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd9c4b0ff3ec065de166e2722981ba38/10f9a/setup.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAA1klEQVQY052MzQ7BQBSF51Fs/CsWEr8tStoITyERtFStRbwYiU6n1rXQ4knamWm4iaQLLMSXk3tPzsm9aKLp+spcmGvNWM2XBkzdMOMZC6qptnhppi/Hk+lmu0PVllQT28pwVBc7DbHblpVOT5VkpdtX5b4KHgzklWozK5RTOSGdL2YKpUQy01MGaH84YEIwxhaG7diEgJyTY2H7aFk2cbBNXPd8vd4834918bzb/Y4opUEQMMYoDTl7A0rKOI+i6PEBhOjxA9E34PdPx1/hnCP2L2EYPgGVvEQCvg8a8wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"get na rota de setup usando o browser\"\n        title=\"get na rota de setup usando o browser\"\n        src=\"/static/bd9c4b0ff3ec065de166e2722981ba38/10f9a/setup.png\"\n        srcset=\"/static/bd9c4b0ff3ec065de166e2722981ba38/12f09/setup.png 148w,\n/static/bd9c4b0ff3ec065de166e2722981ba38/e4a3f/setup.png 295w,\n/static/bd9c4b0ff3ec065de166e2722981ba38/10f9a/setup.png 539w\"\n        sizes=\"(max-width: 539px) 100vw, 539px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Se correu tudo bem até aqui seu bot já vai estar respondendo.</p>\n<p>E ai é você e sua criatividade. Veja o que mais o telegraf tem a oferecer para montar seus bots da hora.</p>\n<p>Se tiver algum feedback ou conseguir construir algo legal por favor me chame no <a href=\"https://twitter.com/eptaccio\">twitter</a> ou <a href=\"https://t.me/eptaccio\">telegram</a>.</p>\n<p>Isso é tudo por enquanto, se pá eu volto mostrando como integrar seu BOT em mais plataformas.</p>","frontmatter":{"title":"Vamos criar nossos próprios assistentes virtuais","date":"April 06, 2020","description":"Começando pelo telegram"}}},"pageContext":{"slug":"/telegram-bot/","previous":null,"next":null}}}